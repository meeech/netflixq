<html>
<script>
//Doing this operation here instead of in pagescript.js, since we want to save in our own 
//localstorage, not in netflixes
var lStore = (('localStorage' in window) && window['localStorage'] !== null) ? window.localStorage : false ;

function getList() {
    return JSON.parse(lStore.getItem('NetflixQList'));
}

function saveList (toSave) {
    lStore.setItem('NetflixQList', JSON.stringify(toSave));
}

chrome.extension.onRequest.addListener( 
    function(request,sender, sendResponse) {
        //Get Queue list
        var nq = getList() || {};

        //Add the requested one
        nq[request.id] = request;
        
        saveList(nq);
        
        //Let the callee know what's up
        sendResponse(nq);
    }
);    
</script>
</html>